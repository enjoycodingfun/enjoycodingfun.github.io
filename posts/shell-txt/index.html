<!DOCTYPE html>
<html>
<head>
    

    
<!-- Tencent Speed -->
<script>var _speedMark = new Date()</script>
<!-- End Tencent Speed -->
<!-- Tencent Analysis -->
<script async src="//tajs.qq.com/stats?sId=66530752"></script>
<!-- End Tencent Analysis -->


    


<!-- Baidu Push -->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- End Baidu Push -->


    <meta charset="utf-8">
    
    
    
    <link rel="canonical" href="https://www.enjoyican.com//posts/shell-txt/">
    
    
    <title>shell中使用正则及脚本输入处理 | Running | Better Late Than Never</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="shell">
    <meta name="description" content="这篇博文接前面两篇介绍shell中使用正则和shell脚本输入处理，有问题及时在本文下或CSDN留言。">
<meta property="og:type" content="article">
<meta property="og:title" content="shell中使用正则及脚本输入处理">
<meta property="og:url" content="https://www.enjoyican.com/posts/shell-txt/index.html">
<meta property="og:site_name" content="Running">
<meta property="og:description" content="这篇博文接前面两篇介绍shell中使用正则和shell脚本输入处理，有问题及时在本文下或CSDN留言。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-25T12:19:30.000Z">
<meta property="article:modified_time" content="2020-08-25T12:19:30.000Z">
<meta property="article:author" content="enjoycodingfun">
<meta property="article:tag" content="shell">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="Running" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/timg.jpg">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/head.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">enjoycodingfun</h5>
          <a href="mailto:17364562230@163.com" title="17364562230@163.com" class="mail">17364562230@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/enjoycodingfun" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://blog.csdn.net/u010408502" target="_blank" rel="noopener"  >
                <i class="icon icon-lg icon-link"></i>
                CSDN
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/img/mywechat.png"  >
                <i class="icon icon-lg icon-wechat"></i>
                微信
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">shell中使用正则及脚本输入处理</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">shell中使用正则及脚本输入处理</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-08-25T12:19:30.000Z" itemprop="datePublished" class="page-time">
  2020-08-25
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>大纲</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#shell中使用正则"><span class="post-toc-text">shell中使用正则</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#正则表达式类型"><span class="post-toc-text">正则表达式类型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#元字符"><span class="post-toc-text">元字符</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#点运算符"><span class="post-toc-text">点运算符 .</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字符集"><span class="post-toc-text">字符集</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#否定字符集"><span class="post-toc-text">否定字符集</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#重复次数"><span class="post-toc-text">重复次数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#号"><span class="post-toc-text">* 号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#号-1"><span class="post-toc-text">+ 号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#号-2"><span class="post-toc-text">? 号</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#号-3"><span class="post-toc-text">{} 号</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#特征标群"><span class="post-toc-text">(...) 特征标群</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#或运算符"><span class="post-toc-text">| 或运算符</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#转码特殊字符"><span class="post-toc-text">转码特殊字符</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#锚点"><span class="post-toc-text">锚点</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#号-4"><span class="post-toc-text">^ 号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#号-5"><span class="post-toc-text">$ 号</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简写字符集"><span class="post-toc-text">简写字符集</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#零宽度断言（前后预查）"><span class="post-toc-text">零宽度断言（前后预查）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#正先行断言"><span class="post-toc-text">?&#x3D;... 正先行断言</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#负先行断言"><span class="post-toc-text">?!... 负先行断言</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#lt-正后发断言"><span class="post-toc-text">?&lt;&#x3D; ... 正后发断言</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#lt-负后发断言"><span class="post-toc-text">?&lt;!... 负后发断言</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#标志"><span class="post-toc-text">标志</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#忽略大小写-Case-Insensitive"><span class="post-toc-text">忽略大小写 (Case Insensitive)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#全局搜索-Global-search"><span class="post-toc-text">全局搜索 (Global search)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#多行修饰符-Multiline"><span class="post-toc-text">多行修饰符 (Multiline)</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#贪婪匹配与惰性匹配-Greedy-vs-lazy-matching"><span class="post-toc-text">贪婪匹配与惰性匹配 (Greedy vs lazy matching)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#POSIX字符类"><span class="post-toc-text">POSIX字符类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#bash正则"><span class="post-toc-text">bash正则</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#脚本输入处理"><span class="post-toc-text">脚本输入处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参数处理"><span class="post-toc-text">参数处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#输入参数大小写不敏感"><span class="post-toc-text">输入参数大小写不敏感</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用shift命令处理命令行参数"><span class="post-toc-text">使用shift命令处理命令行参数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用for循环读取多个参数"><span class="post-toc-text">使用for循环读取多个参数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#读取脚本名称"><span class="post-toc-text">读取脚本名称</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#选项处理"><span class="post-toc-text">选项处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用case语句处理命令行选项"><span class="post-toc-text">使用case语句处理命令行选项</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用getopts处理多命令行选项"><span class="post-toc-text">使用getopts处理多命令行选项</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用getopt处理多命令行选项"><span class="post-toc-text">使用getopt处理多命令行选项</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获得用户输入"><span class="post-toc-text">获得用户输入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#基本的读取"><span class="post-toc-text">基本的读取</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#输入超时"><span class="post-toc-text">输入超时</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#隐藏方式读取"><span class="post-toc-text">隐藏方式读取</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#从文件中读取"><span class="post-toc-text">从文件中读取</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-shell-txt"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">shell中使用正则及脚本输入处理</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-08-25 20:19:30" datetime="2020-08-25T12:19:30.000Z"  itemprop="datePublished">2020-08-25</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>这篇博文接前面两篇介绍shell中使用正则和shell脚本输入处理，有问题及时在本文下或<a href="https://blog.csdn.net/u010408502/article/details/108238438" target="_blank" rel="noopener">CSDN</a>留言。</p>
<a id="more"></a>

<h2 id="shell中使用正则"><a href="#shell中使用正则" class="headerlink" title="shell中使用正则"></a>shell中使用正则</h2><p>关于正则表达式的基础知识，这里不展开，只说怎么用。</p>
<h3 id="正则表达式类型"><a href="#正则表达式类型" class="headerlink" title="正则表达式类型"></a>正则表达式类型</h3><p><strong>正则表达式包括基本正则表达式和拓展正则表达式</strong></p>
<p>基本表达式：</p>
<h3 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h3><table>
<thead>
<tr>
<th>元字符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>句号匹配任意单个字符除了换行符。</td>
</tr>
<tr>
<td>[ ]</td>
<td>字符种类。匹配方括号内的任意字符。</td>
</tr>
<tr>
<td>[^ ]</td>
<td>否定的字符种类。匹配除了方括号里的任意字符</td>
</tr>
<tr>
<td>*</td>
<td>匹配&gt;=0个重复的在*号之前的字符。</td>
</tr>
<tr>
<td>+</td>
<td>匹配&gt;=1个重复的+号前的字符。</td>
</tr>
<tr>
<td>?</td>
<td>标记?之前的字符为可选.</td>
</tr>
<tr>
<td>{n,m}</td>
<td>匹配num个大括号之前的字符或字符集 (n &lt;= num &lt;= m).</td>
</tr>
<tr>
<td>(xyz)</td>
<td>字符集，匹配与 xyz 完全相等的字符串.</td>
</tr>
<tr>
<td>|</td>
<td>或运算符，匹配符号前或后的字符.</td>
</tr>
<tr>
<td>\</td>
<td>转义字符,用于匹配一些保留的字符 `[ ] ( ) { } . * + ? ^ $ \</td>
</tr>
<tr>
<td>^</td>
<td>从开始行开始匹配.</td>
</tr>
<tr>
<td>$</td>
<td>从末端开始匹配.</td>
</tr>
</tbody></table>
<h4 id="点运算符"><a href="#点运算符" class="headerlink" title="点运算符 ."></a>点运算符 <code>.</code></h4><p><code>.</code>是元字符中最简单的例子。 <code>.</code>匹配任意单个字符，但不匹配换行符。 例如，表达式<code>.ar</code>匹配一个任意字符后面跟着是<code>a</code>和<code>r</code>的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;.ar&quot; &#x3D;&gt; The car parked in the garage.</span><br></pre></td></tr></table></figure>

<h4 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h4><p>字符集也叫做字符类。 方括号用来指定一个字符集。 在方括号中使用连字符来指定字符集的范围。 在方括号中的字符集不关心顺序。 例如，表达式<code>[Tt]he</code> 匹配 <code>the</code> 和 <code>The</code>。</p>
<figure class="highlight re"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"[Tt]he"</span> =&gt; The car parked <span class="keyword">in</span> the garage.</span><br></pre></td></tr></table></figure>

<p>方括号的句号就表示句号。 表达式 <code>ar[.]</code> 匹配 <code>ar.</code>字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;ar[.]&quot; &#x3D;&gt; A garage is a good place to park a car.</span><br></pre></td></tr></table></figure>

<h4 id="否定字符集"><a href="#否定字符集" class="headerlink" title="否定字符集"></a>否定字符集</h4><p>一般来说 <code>^</code> 表示一个字符串的开头，但它用在一个方括号的开头的时候，它表示这个字符集是否定的。 例如，表达式<code>[^c]ar</code> 匹配一个后面跟着<code>ar</code>的除了<code>c</code>的任意字符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[^c]ar&quot; &#x3D;&gt; The car parked in the garage.</span><br></pre></td></tr></table></figure>

<h4 id="重复次数"><a href="#重复次数" class="headerlink" title="重复次数"></a>重复次数</h4><p>后面跟着元字符 <code>+</code>，<code>*</code> or <code>?</code> 的，用来指定匹配子模式的次数。 这些元字符在不同的情况下有着不同的意思。</p>
<h5 id="号"><a href="#号" class="headerlink" title="* 号"></a><code>*</code> 号</h5><p><code>*</code>号匹配 在<code>*</code>之前的字符出现<code>大于等于0</code>次。 例如，表达式 <code>a*</code> 匹配0或更多个以a开头的字符。表达式<code>[a-z]*</code> 匹配一个行中所有以小写字母开头的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[a-z]*&quot; &#x3D;&gt; The car parked in the garage #21.</span><br></pre></td></tr></table></figure>

<p><code>*</code>字符和<code>.</code>字符搭配可以匹配所有的字符<code>.*</code>。 <code>*</code>和表示匹配空格的符号<code>\s</code>连起来用，如表达式<code>\s*cat\s*</code>匹配0或更多个空格开头和0或更多个空格结尾的cat字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;\s*cat\s*&quot; &#x3D;&gt; The fat cat sat on the concatenation.</span><br></pre></td></tr></table></figure>

<h5 id="号-1"><a href="#号-1" class="headerlink" title="+ 号"></a><code>+</code> 号</h5><p><code>+</code>号匹配<code>+</code>号之前的字符出现 &gt;=1 次。 例如表达式<code>c.+t</code> 匹配以首字母<code>c</code>开头以<code>t</code>结尾，中间跟着至少一个字符的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;c.+t&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h5 id="号-2"><a href="#号-2" class="headerlink" title="? 号"></a><code>?</code> 号</h5><p>在正则表达式中元字符 <code>?</code> 标记在符号前面的字符为可选，即出现 0 或 1 次。 例如，表达式 <code>[T]?he</code> 匹配字符串 <code>he</code> 和 <code>The</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[T]he&quot; &#x3D;&gt; The car is parked in the garage.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[T]?he&quot; &#x3D;&gt; The car is parked in the garage.</span><br></pre></td></tr></table></figure>

<h4 id="号-3"><a href="#号-3" class="headerlink" title="{} 号"></a><code>{}</code> 号</h4><p>在正则表达式中 <code>{}</code> 是一个量词，常用来限定一个或一组字符可以重复出现的次数。 例如， 表达式 <code>[0-9]{2,3}</code> 匹配最少 2 位最多 3 位 0~9 的数字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[0-9]&#123;2,3&#125;&quot; &#x3D;&gt; The number was 9.9997 but we rounded it off to 10.0.</span><br></pre></td></tr></table></figure>

<p>我们可以省略第二个参数。 例如，<code>[0-9]{2,}</code> 匹配至少两位 0~9 的数字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[0-9]&#123;2,&#125;&quot; &#x3D;&gt; The number was 9.9997 but we rounded it off to 10.0.</span><br></pre></td></tr></table></figure>

<p>如果逗号也省略掉则表示重复固定的次数。 例如，<code>[0-9]{3}</code> 匹配3位数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[0-9]&#123;3&#125;&quot; &#x3D;&gt; The number was 9.9997 but we rounded it off to 10.0.</span><br></pre></td></tr></table></figure>

<h4 id="特征标群"><a href="#特征标群" class="headerlink" title="(...) 特征标群"></a><code>(...)</code> 特征标群</h4><p>特征标群是一组写在 <code>(...)</code> 中的子模式。<code>(...)</code> 中包含的内容将会被看成一个整体，和数学中小括号（ ）的作用相同。例如, 表达式 <code>(ab)*</code> 匹配连续出现 0 或更多个 <code>ab</code>。如果没有使用 <code>(...)</code> ，那么表达式 <code>ab*</code> 将匹配连续出现 0 或更多个 <code>b</code> 。再比如之前说的 <code>{}</code> 是用来表示前面一个字符出现指定次数。但如果在 <code>{}</code> 前加上特征标群 <code>(...)</code> 则表示整个标群内的字符重复 N 次。</p>
<p>我们还可以在 <code>()</code> 中用或字符 <code>|</code> 表示或。例如，<code>(c|g|p)ar</code> 匹配 <code>car</code> 或 <code>gar</code> 或 <code>par</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(c|g|p)ar&quot; &#x3D;&gt; The car is parked in the garage.</span><br></pre></td></tr></table></figure>

<h4 id="或运算符"><a href="#或运算符" class="headerlink" title="| 或运算符"></a><code>|</code> 或运算符</h4><p>或运算符就表示或，用作判断条件。</p>
<p>例如 <code>(T|t)he|car</code> 匹配 <code>(T|t)he</code> 或 <code>car</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(T|t)he|car&quot; &#x3D;&gt; The car is parked in the garage.</span><br></pre></td></tr></table></figure>

<h4 id="转码特殊字符"><a href="#转码特殊字符" class="headerlink" title="转码特殊字符"></a>转码特殊字符</h4><p>反斜线 <code>\</code> 在表达式中用于转码紧跟其后的字符。用于指定 <code>{ } [ ] / \ + * . $ ^ | ?</code> 这些特殊字符。如果想要匹配这些特殊字符则要在其前面加上反斜线 <code>\</code>。</p>
<p>例如 <code>.</code> 是用来匹配除换行符外的所有字符的。如果想要匹配句子中的 <code>.</code> 则要写成 <code>\.</code> 以下这个例子 <code>\.?</code>是选择性匹配<code>.</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(f|c|m)at\.?&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h4 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h4><p>在正则表达式中，想要匹配指定开头或结尾的字符串就要使用到锚点。<code>^</code> 指定开头，<code>$</code> 指定结尾。</p>
<h5 id="号-4"><a href="#号-4" class="headerlink" title="^ 号"></a><code>^</code> 号</h5><p><code>^</code> 用来检查匹配的字符串是否在所匹配字符串的开头。</p>
<p>例如，在 <code>abc</code> 中使用表达式 <code>^a</code> 会得到结果 <code>a</code>。但如果使用 <code>^b</code> 将匹配不到任何结果。因为在字符串 <code>abc</code> 中并不是以 <code>b</code> 开头。</p>
<p>例如，<code>^(T|t)he</code> 匹配以 <code>The</code> 或 <code>the</code> 开头的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(T|t)he&quot; &#x3D;&gt; The car is parked in the garage.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;^(T|t)he&quot; &#x3D;&gt; The car is parked in the garage.</span><br></pre></td></tr></table></figure>

<h5 id="号-5"><a href="#号-5" class="headerlink" title="$ 号"></a><code>$</code> 号</h5><p>同理于 <code>^</code> 号，<code>$</code> 号用来匹配字符是否是最后一个。</p>
<p>例如，<code>(at\.)$</code> 匹配以 <code>at.</code> 结尾的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(at\.)&quot; &#x3D;&gt; The fat cat. sat. on the mat.</span><br></pre></td></tr></table></figure>

<h3 id="简写字符集"><a href="#简写字符集" class="headerlink" title="简写字符集"></a>简写字符集</h3><table>
<thead>
<tr>
<th>简写</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>除换行符外的所有字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配所有字母数字，等同于 <code>[a-zA-Z0-9_]</code></td>
</tr>
<tr>
<td>\W</td>
<td>匹配所有非字母数字，即符号，等同于： <code>[^\w]</code></td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字： <code>[0-9]</code></td>
</tr>
<tr>
<td>\D</td>
<td>匹配非数字： <code>[^\d]</code></td>
</tr>
<tr>
<td>\s</td>
<td>匹配所有空格字符，等同于： <code>[\t\n\f\r\p{Z}]</code></td>
</tr>
<tr>
<td>\S</td>
<td>匹配所有非空格字符： <code>[^\s]</code></td>
</tr>
<tr>
<td>\f</td>
<td>匹配一个换页符</td>
</tr>
<tr>
<td>\n</td>
<td>匹配一个换行符</td>
</tr>
<tr>
<td>\r</td>
<td>匹配一个回车符</td>
</tr>
<tr>
<td>\t</td>
<td>匹配一个制表符</td>
</tr>
<tr>
<td>\v</td>
<td>匹配一个垂直制表符</td>
</tr>
<tr>
<td>\p</td>
<td>匹配 CR/LF（等同于 <code>\r\n</code>），用来匹配 DOS 行终止符</td>
</tr>
</tbody></table>
<h3 id="零宽度断言（前后预查）"><a href="#零宽度断言（前后预查）" class="headerlink" title="零宽度断言（前后预查）"></a>零宽度断言（前后预查）</h3><p>先行断言和后发断言都属于<strong>非捕获簇</strong>（不捕获文本 ，也不针对组合计进行计数）。 先行断言用于判断所匹配的格式是否在另一个确定的格式之前，匹配结果不包含该确定格式（仅作为约束）。</p>
<p>例如，我们想要获得所有跟在 <code>$</code> 符号后的数字，我们可以使用正后发断言 <code>(?&lt;=\$)[0-9\.]*</code>。 这个表达式匹配 <code>$</code> 开头，之后跟着 <code>0,1,2,3,4,5,6,7,8,9,.</code> 这些字符可以出现大于等于 0 次。</p>
<p>零宽度断言如下：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>?=</td>
<td>正先行断言-存在</td>
</tr>
<tr>
<td>?!</td>
<td>负先行断言-排除</td>
</tr>
<tr>
<td>?&lt;=</td>
<td>正后发断言-存在</td>
</tr>
<tr>
<td>?&lt;!</td>
<td>负后发断言-排除</td>
</tr>
</tbody></table>
<h4 id="正先行断言"><a href="#正先行断言" class="headerlink" title="?=... 正先行断言"></a><code>?=...</code> 正先行断言</h4><p><code>?=...</code> 正先行断言，表示第一部分表达式之后必须跟着 <code>?=...</code>定义的表达式。</p>
<p>返回结果只包含满足匹配条件的第一部分表达式。 定义一个正先行断言要使用 <code>()</code>。在括号内部使用一个问号和等号： <code>(?=...)</code>。</p>
<p>正先行断言的内容写在括号中的等号后面。 例如，表达式 <code>(T|t)he(?=\sfat)</code> 匹配 <code>The</code> 和 <code>the</code>，在括号中我们又定义了正先行断言 <code>(?=\sfat)</code> ，即 <code>The</code> 和 <code>the</code> 后面紧跟着 <code>(空格)fat</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(T|t)he(?&#x3D;\sfat)&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h4 id="负先行断言"><a href="#负先行断言" class="headerlink" title="?!... 负先行断言"></a><code>?!...</code> 负先行断言</h4><p>负先行断言 <code>?!</code> 用于筛选所有匹配结果，筛选条件为 其后不跟随着断言中定义的格式。 <code>正先行断言</code> 定义和 <code>负先行断言</code> 一样，区别就是 <code>=</code> 替换成 <code>!</code> 也就是 <code>(?!...)</code>。</p>
<p>表达式 <code>(T|t)he(?!\sfat)</code> 匹配 <code>The</code> 和 <code>the</code>，且其后不跟着 <code>(空格)fat</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(T|t)he(?!\sfat)&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h4 id="lt-正后发断言"><a href="#lt-正后发断言" class="headerlink" title="?&lt;= ... 正后发断言"></a><code>?&lt;= ...</code> 正后发断言</h4><p>正后发断言 记作<code>(?&lt;=...)</code> 用于筛选所有匹配结果，筛选条件为 其前跟随着断言中定义的格式。 例如，表达式 <code>(?&lt;=(T|t)he\s)(fat|mat)</code> 匹配 <code>fat</code> 和 <code>mat</code>，且其前跟着 <code>The</code> 或 <code>the</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;(?&lt;&#x3D;(T|t)he\s)(fat|mat)&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h4 id="lt-负后发断言"><a href="#lt-负后发断言" class="headerlink" title="?&lt;!... 负后发断言"></a><code>?&lt;!...</code> 负后发断言</h4><p>负后发断言 记作 <code>(?&lt;!...)</code> 用于筛选所有匹配结果，筛选条件为 其前不跟随着断言中定义的格式。 例如，表达式 <code>(?&lt;!(T|t)he\s)(cat)</code> 匹配 <code>cat</code>，且其前不跟着 <code>The</code> 或 <code>the</code>。</p>
<h3 id="标志"><a href="#标志" class="headerlink" title="标志"></a>标志</h3><p>标志也叫模式修正符，因为它可以用来修改表达式的搜索结果。 这些标志可以任意的组合使用，它也是整个正则表达式的一部分。</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>i</td>
<td>忽略大小写。</td>
</tr>
<tr>
<td>g</td>
<td>全局搜索。</td>
</tr>
<tr>
<td>m</td>
<td>多行修饰符：锚点元字符 <code>^</code> <code>$</code> 工作范围在每行的起始。</td>
</tr>
</tbody></table>
<h4 id="忽略大小写-Case-Insensitive"><a href="#忽略大小写-Case-Insensitive" class="headerlink" title="忽略大小写 (Case Insensitive)"></a>忽略大小写 (Case Insensitive)</h4><p>修饰语 <code>i</code> 用于忽略大小写。 例如，表达式 <code>/The/gi</code> 表示在全局搜索 <code>The</code>，在后面的 <code>i</code> 将其条件修改为忽略大小写，则变成搜索 <code>the</code> 和 <code>The</code>，<code>g</code> 表示全局搜索。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;The&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;The&#x2F;gi&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h4 id="全局搜索-Global-search"><a href="#全局搜索-Global-search" class="headerlink" title="全局搜索 (Global search)"></a>全局搜索 (Global search)</h4><p>修饰符 <code>g</code> 常用于执行一个全局搜索匹配，即（不仅仅返回第一个匹配的，而是返回全部）。 例如，表达式 <code>/.(at)/g</code> 表示搜索 任意字符（除了换行）+ <code>at</code>，并返回全部结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;.(at)&#x2F;&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;.(at)&#x2F;g&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<h4 id="多行修饰符-Multiline"><a href="#多行修饰符-Multiline" class="headerlink" title="多行修饰符 (Multiline)"></a>多行修饰符 (Multiline)</h4><p>多行修饰符 <code>m</code> 常用于执行一个多行匹配。</p>
<p>像之前介绍的 <code>(^,$)</code> 用于检查格式是否是在待检测字符串的开头或结尾。但我们如果想要它在每行的开头和结尾生效，我们需要用到多行修饰符 <code>m</code>。</p>
<p>例如，表达式 <code>/at(.)?$/gm</code> 表示小写字符 <code>a</code> 后跟小写字符 <code>t</code> ，末尾可选除换行符外任意字符。根据 <code>m</code> 修饰符，现在表达式匹配每行的结尾。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;.at(.)?$&#x2F;&quot; &#x3D;&gt; The fat</span><br><span class="line">                cat sat</span><br><span class="line">                on the mat.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;.at(.)?$&#x2F;gm&quot; &#x3D;&gt; The fat</span><br><span class="line">                  cat sat</span><br><span class="line">                  on the mat.</span><br></pre></td></tr></table></figure>

<h3 id="贪婪匹配与惰性匹配-Greedy-vs-lazy-matching"><a href="#贪婪匹配与惰性匹配-Greedy-vs-lazy-matching" class="headerlink" title="贪婪匹配与惰性匹配 (Greedy vs lazy matching)"></a>贪婪匹配与惰性匹配 (Greedy vs lazy matching)</h3><p>正则表达式默认采用贪婪匹配模式，在该模式下意味着会匹配尽可能长的子串。我们可以使用 <code>?</code> 将贪婪匹配模式转化为惰性匹配模式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;(.*at)&#x2F;&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#x2F;(.*?at)&#x2F;&quot; &#x3D;&gt; The fat cat sat on the mat.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上正则基础知识内容来源于<a href="https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md" target="_blank" rel="noopener">learn-regex</a></p>
</blockquote>
<p>下面介绍下POSIX字符类：</p>
<h3 id="POSIX字符类"><a href="#POSIX字符类" class="headerlink" title="POSIX字符类"></a>POSIX字符类</h3><blockquote>
<p>[:alnum:]：匹配字面和数字字符。等同于A<del>Z,a</del>z,0~9</p>
<p>[:alpha:]：匹配字母字符。等同于A<del>Z，a</del>z</p>
<p>[:blank:]：匹配空格或制表符</p>
<p>[:cntrl:]：匹配控制字符<br>[:digit:]：匹配十进制数字。等同于0~9</p>
<p>[:graph:]：匹配ASCII码值范围33~126的字符。与[:print:]相似，但不包括空格字符</p>
<p>[:print:]：与[:graph:]相同，但多了空格字符</p>
<p>[:lower:]：匹配小写字母，等同于a~z</p>
<p>[:upper:]：匹配大写字母，等同于A~Z</p>
<p>[:space:]：匹配空白字符（空格和制表符）</p>
<p>[:xdigit:]：匹配十六进制数字。等同于0<del>9，A</del>F，a~f</p>
</blockquote>
<p><strong>POSIX字符类通常需要引用或双方括号（[[]]）括起来</strong></p>
<h3 id="bash正则"><a href="#bash正则" class="headerlink" title="bash正则"></a>bash正则</h3><p>bash中使用”=~”表示正则表达式比较操作符，正则表达式匹配成功，返回状态码0，匹配失败，返回状态码1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取用户从键盘的输入，存入变量num</span></span><br><span class="line"><span class="built_in">read</span><span class="params"> -p</span> <span class="string">"please input a number,please: "</span> num</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$num</span> =~ ^[0-9]+$ ]];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"输入正确"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"输入有误，请重新输入"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#执行正则</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh</span></span><br><span class="line">please input a number,please: 3</span><br><span class="line">输入正确</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh</span></span><br><span class="line">please input a number,please: v</span><br><span class="line">输入有误，请重新输入</span><br></pre></td></tr></table></figure>

<p>在bash中使用正则匹配的语法为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">"regex"</span> 文件</span><br></pre></td></tr></table></figure>

<h2 id="脚本输入处理"><a href="#脚本输入处理" class="headerlink" title="脚本输入处理"></a>脚本输入处理</h2><h3 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h3><h4 id="输入参数大小写不敏感"><a href="#输入参数大小写不敏感" class="headerlink" title="输入参数大小写不敏感"></a>输入参数大小写不敏感</h4><p>之前博文中已经讲过给函数传递参数的知识点，给脚本传递参数也是类似的，当我们执行脚本的时候也可以通过位置参数传递参数，内部通过case或”[[“条件命令，来确定shell执行路径，但是shell对于参数默认是大小写敏感的，如果我们想使脚本大小写不敏感，可以在脚本首行中加入<code>shopt -s nocasematch</code>来<code>开启</code>nocasematch选项，在末尾加入<code>shopt -u nocasematch</code>来<code>关闭</code>nocasematch选项,也可以通过正则匹配大小写来实现，不过这种不是很方便</p>
<h4 id="使用shift命令处理命令行参数"><a href="#使用shift命令处理命令行参数" class="headerlink" title="使用shift命令处理命令行参数"></a>使用shift命令处理命令行参数</h4><p>当脚本只有一个命令行参数时，内部用case来分不同情况很方便，但是当脚本有多个参数时，使用case就不方便了，这时候可以使用<code>shift</code>命令在一个变量中一个接一个的获取多个命令行参数，语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">shift</span> [n]</span><br></pre></td></tr></table></figure>

<p>n必须是一个小于或等于”$#”（参数个数）的非负整数。n为0或者大于”$#”,位置参数都不会改变，如果不指定n，默认设为1，如果n大于”$#”或小于0，此命令返回状态码将大于0，否则为0.</p>
<p>当我们使用shift 1 命令时，位置参数将移动一位，原来$2位置参数赋值给$1,以此类推，原来的变量$1的值将被废弃。同理，如果我们使用shift 5，位置参数原来$6的参数值赋值给$1,$7的值赋值给$2，以此类推，原来的变量$1-$5的值将被废弃。</p>
<p>在每次移动之后，特殊变量$#（位置参数个数）的值也会调整，而特殊变量$0（当前运行脚本名称）不参与移位操作。如果我们读取$1的值，然后运行命令<code>shift</code>,再次读取特殊变量$1的值，将得到$2的值，然后再次运行命令shift，再次读取特殊变量$1的值，将得到$3的值，依次类推。因此，只要$#的值不为0，就可以在while循环中进行迭代，获取特殊变量$1的值，运行shift命令，然后再次读取$1的值，来依次获取所有传递的命令行参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建test.sh文件如下：</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span><span class="params"> -ne</span> 0 ];</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"当前打印参数：<span class="variable">$1</span>"</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh one two three</span></span><br><span class="line">当前打印参数：one</span><br><span class="line">当前打印参数：two</span><br><span class="line">当前打印参数：three</span><br></pre></td></tr></table></figure>

<p>有时候我们传入的参数个数和shift后面的n不是整除关系，比如传入的参数个数是7个，n是5，当第一次随时用shift5时，会将$6的值给到$1，但是第二次执行时，由于只剩下两个元素，$#的值变为2，第二次移位不会再发生，while循环将无限进行下去。</p>
<p>为了解决以上问题，我们可以判断每次执行shift命令的结果，如果正确执行了，就继续，没有执行就退出循环，通过特殊变量$?判断命令返回码是否为0，为0说明正确执行，否则没有正确执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span><span class="params"> -ne</span> 0 ];</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"当前打印参数：<span class="variable">$1</span>"</span></span><br><span class="line"><span class="built_in">shift</span> 2</span><br><span class="line"><span class="keyword">if</span> [ $?<span class="params"> -ne</span> 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h4 id="使用for循环读取多个参数"><a href="#使用for循环读取多个参数" class="headerlink" title="使用for循环读取多个参数"></a>使用for循环读取多个参数</h4><p>当命令行参数比较多的时候，使用$1,$2一个一个参数获取，编程就不是很方便了，这个时候可以通过for循环，配合$*及$@来列出传递给脚本的所有命令行参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ !<span class="params"> -n</span> <span class="string">"<span class="variable">$1</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"参数为空，退出脚本"</span></span><br><span class="line">  <span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">index=1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"通过\$*遍历元素"</span></span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> $*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前打印参数为：#<span class="variable">$index</span> = <span class="variable">$arg</span>"</span></span><br><span class="line">  <span class="comment">#将变量index的值加1</span></span><br><span class="line">  <span class="built_in">let</span> index+=1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将变量index的值重新置为1</span></span><br><span class="line">index=1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"通过\"\$@\"遍历元素"</span></span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前打印参数为：#<span class="variable">$index</span> = <span class="variable">$arg</span>"</span></span><br><span class="line">  <span class="comment">#将变量index的值加1</span></span><br><span class="line">  <span class="built_in">let</span> index+=1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh one two three four five six</span></span><br><span class="line">通过$*遍历元素</span><br><span class="line">当前打印参数为：<span class="comment">#1 = one</span></span><br><span class="line">当前打印参数为：<span class="comment">#2 = two</span></span><br><span class="line">当前打印参数为：<span class="comment">#3 = three</span></span><br><span class="line">当前打印参数为：<span class="comment">#4 = four</span></span><br><span class="line">当前打印参数为：<span class="comment">#5 = five</span></span><br><span class="line">当前打印参数为：<span class="comment">#6 = six</span></span><br><span class="line">通过<span class="string">"<span class="variable">$@</span>"</span>遍历元素</span><br><span class="line">当前打印参数为：<span class="comment">#1 = one</span></span><br><span class="line">当前打印参数为：<span class="comment">#2 = two</span></span><br><span class="line">当前打印参数为：<span class="comment">#3 = three</span></span><br><span class="line">当前打印参数为：<span class="comment">#4 = four</span></span><br><span class="line">当前打印参数为：<span class="comment">#5 = five</span></span><br><span class="line">当前打印参数为：<span class="comment">#6 = six</span></span><br></pre></td></tr></table></figure>

<p>上面脚本中，引用$*没有加双引号，是因为如果加了双引号,其值将被扩展为包含所有位置参数的值的单个字符串，这样for循环只能进行一次，参考<a href="https://www.enjoyican.com/posts/shell-grammar/#特殊参数">特殊参数</a></p>
<h4 id="读取脚本名称"><a href="#读取脚本名称" class="headerlink" title="读取脚本名称"></a>读取脚本名称</h4><p>在shell脚本中，特殊变量$0是脚本的名称，在脚本中我们运行一段脚本之前可以将脚本名输出，当脚本输入参数有误时，也可以将脚本名及使用方法打印出来，总之，读取脚本名有其特定的应用场合。</p>
<h3 id="选项处理"><a href="#选项处理" class="headerlink" title="选项处理"></a>选项处理</h3><p>我们在执行脚本时候，如果有多个参数，有时候我们脚本的要求不仅要参数个数正确，还需要参数顺序正确。为此，我们通过处理，使shell脚本的执行命令可以通过选项指定参数顺序和类型。比如一个脚本需要三个参数，一个配置文件，一个输入文件，一个输出文件，我们可以通过-c选项指定配置文件，通过-in指定输入文件，通过-out指定输出文件，那么执行脚本时候就可以</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx.sh<span class="params"> -c</span> my.cof<span class="params"> -in</span> input.txt<span class="params"> -out</span> out.txt</span><br></pre></td></tr></table></figure>

<p>下面介绍如何在shell脚本中实现命令行选项的处理</p>
<h4 id="使用case语句处理命令行选项"><a href="#使用case语句处理命令行选项" class="headerlink" title="使用case语句处理命令行选项"></a>使用case语句处理命令行选项</h4><p>当参数只有一个的时候，使用case来处理选项是很方便的，比如一个脚本copy.sh执行时一次只能有一个参数，当使用-c时，拷贝指定的文件，当时用-m时移动指定的文件，那么我们的命令行参数有两个，一个是选项(-c /-m)，另一个是文件名，在脚本中我们就可以通过对第一个参数进行验证，来执行不同的指令，此处不再举例。</p>
<h4 id="使用getopts处理多命令行选项"><a href="#使用getopts处理多命令行选项" class="headerlink" title="使用getopts处理多命令行选项"></a>使用getopts处理多命令行选项</h4><p><strong>注意</strong>：<code>getopts</code>不能解析GNU风格的长选项（–myoption）或XF86风格的长选项（-myoptions）</p>
<p>假设有如下脚本，调用此脚本时指定如下选项参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>.sh<span class="params"> -x</span><span class="params"> -f</span> /etc/<span class="built_in">test</span>.conf<span class="params"> -r</span> ./<span class="built_in">source</span>.txt ./destination.txt</span><br></pre></td></tr></table></figure>

<p>上述选项参数可以划分为如下逻辑组：</p>
<p>-x,-r都是一个单独的选项，后面不跟参数</p>
<p>-f也是一个选项，且选项后跟一个参数/etc/test.conf，并且参数与选项之间用空格隔开</p>
<p>./source.txt ./destination.txt是不与任何选项关联的两个参数</p>
<p>当我们在test.sh脚本中使用getopts来处理命令行选项和参数，上面的命令还可以写成</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>.sh<span class="params"> -xrf</span> /etc/<span class="built_in">test</span>.conf ./<span class="built_in">source</span>.txt ./destination.txt</span><br></pre></td></tr></table></figure>

<p><code>getopts</code>可以识别所有这些选项格式，<strong>指定的选项可以是大写或者小写字母，或者数字</strong>，其他字符也能识别，但是不推荐使用。在处理命令行选项和参数时，需要多次调用getopts，且该命令本身不会更改位置参数的设置，要想将位置参数移位，必须使用shift命令来处理位置参数。</p>
<p>当没有内容可以解析时，getopts会设置一个退出状态FALSE，所以在循环中可以很容易使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> ...; <span class="keyword">do</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>getopts将会解析选项和它们可能的参数，它将在第一个非选项参数（不以连字符”-“开头的，且不是它前面的任何选项的参数的字符串）的位置停止解析。当遇到双连字符”–”(表示选项的结束)时，也将停止解析。</p>
<p>getopts会使用到以下3个变量</p>
<p><code>OPTIND</code> : 存放下一个要处理的参数的索引，这是getopts在调用过程中记住自己状态的方式，同样可以用于移位使用getopts处理后的位置参数。OPTIND初始被设为1，想再次使用getopts解析任何内容，需要将其重置为1.</p>
<p><code>OPTARG</code> : 这个变量被设置为由getopts找到的选项所对应的参数。</p>
<p><code>OPTERR</code> : 值为0或1，指示bash是否应该显示由getopts产生的错误信息。在每个shell启动时，它的值被初始化为1，如果不想看到相关信息，请确保设置为0</p>
<blockquote>
<p>getopts命令的基本语法是：getopts OPTSTRING VARNAME ARGS…</p>
</blockquote>
<p><code>OPTSTRING</code> :告诉getopts会有哪些选项和在哪会有参数（用选项后加冒号”:”表示）</p>
<p><code>VANAME</code> : 告诉getopts哪个变量用于选项</p>
<p><code>ARGS</code> : 告诉getopts解析这些可选的参数，而不是位置参数</p>
<p>比如下面的命令告诉getopts查找-f、-A和-x</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getopts</span> fAx VARNAME</span><br></pre></td></tr></table></figure>

<p>下面的命令告诉getopts命令，-A选项后面会有一个参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getopts</span> fA:x VARNAME</span><br></pre></td></tr></table></figure>

<p>默认情况下，getopts命令是解析当前shell或者函数的位置参数，也可以指定自己的参数让getopts来解析。</p>
<p>getopts支持两种错误报告模式，详细模式和抑制错误报告模式。</p>
<p>详细模式下，如果getopts遇到无效选项或者需要的参数没找到，VARNAME值会被设置为问号(?),并且变量OPTARG不会被设置；</p>
<p>抑制错误报告模式下：如果遇到无效选项，VARNAME值会被设置为问号(?)，并且OPTARG会被设置为选项字符；如果需要的参数没有找到，VARNAME值会被设置为冒号(:)，并且变量OPTARG中会包含选项字符。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#test</span>.sh</span><br><span class="line"><span class="comment">#使用getopts解析命令行选项，这里仅解析-a选项，选项字符串中第一个字符为冒号(:)</span></span><br><span class="line"><span class="comment">#表示抑制错误报告</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">":a"</span> opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$opt</span> <span class="keyword">in</span></span><br><span class="line">  a)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"选项参数-a 已获取"</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="comment">#匹配其他选项</span></span><br><span class="line">  \?)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"无效的参数选项： -<span class="variable">$&#123;OPTARG&#125;</span>"</span></span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#下面执行脚本</span></span><br><span class="line"><span class="comment">#下面这个getopts没有看到任何有效或无效的选项，所以没有被触发</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh</span></span><br><span class="line"><span class="comment">#下面这个运行脚本时指定的是一个命令行参数而不是选项，所以没有任何输出</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh /usr</span></span><br><span class="line"><span class="keyword">#getopts</span>被触发了，并且将?放到了变量opt中，将无效选项字符b放入变量OPTARG中</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -b</span></span><br><span class="line">无效的参数选项：<span class="params"> -b</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -a</span></span><br><span class="line">选项参数-a 已获取</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -a -a -a -a</span></span><br><span class="line">选项参数-a 已获取</span><br><span class="line">选项参数-a 已获取</span><br><span class="line">选项参数-a 已获取</span><br><span class="line">选项参数-a 已获取</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -a -b -c -d</span></span><br><span class="line">选项参数-a 已获取</span><br><span class="line">无效的参数选项：<span class="params"> -b</span></span><br><span class="line">无效的参数选项：<span class="params"> -c</span></span><br><span class="line">无效的参数选项：<span class="params"> -d</span></span><br></pre></td></tr></table></figure>

<p>从上面脚本执行情况可以看出，无效的选项不会停止处理：如果我们希望遇到无效选项就开始停止处理，必须做一些完善操作（在正确的位置执行退出操作）；多个相同的选项是可能的，如果想禁止重复的选项，必须在脚本中做一些检查操作。</p>
<p>下面是一个接受多参数的示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义变量vflag</span></span><br><span class="line">vflag=off</span><br><span class="line"><span class="comment">#定义变量filename</span></span><br><span class="line">filename=<span class="string">""</span></span><br><span class="line"><span class="comment">#定义变量output</span></span><br><span class="line">output=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义函数usage</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前脚本用法如下"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"./test.sh [-h] [-v] [-f &lt;filename&gt;] [-o &lt;filename&gt;]"</span></span><br><span class="line">  <span class="built_in">exit</span><span class="params"> -1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#在while循环中使用getopts解析命令行选项-h、-v、-f和-o，其中-f和-o选项带有参数</span></span><br><span class="line"><span class="comment">#字符串选项中第一个冒号表示getopts使用抑制错误报告模式</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :hvf:o: opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$opt</span> <span class="keyword">in</span></span><br><span class="line">  v)</span><br><span class="line">    vflag=on</span><br><span class="line">    ;;</span><br><span class="line">  f)</span><br><span class="line">    <span class="comment">#将-f选项的参数赋值给filename</span></span><br><span class="line">    filename=<span class="variable">$OPTARG</span></span><br><span class="line">    <span class="comment">#如果文件不存在，则显示提示信息，并退出脚本的执行</span></span><br><span class="line">    <span class="keyword">if</span> [ !<span class="params"> -f</span> <span class="variable">$filename</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"输入的参数<span class="variable">$filename</span>不存在"</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line">  o)</span><br><span class="line">    <span class="comment">#将-o选项的参数赋值给output</span></span><br><span class="line">    output=<span class="variable">$OPTARG</span></span><br><span class="line">    <span class="comment">#如果指定的输出文件的目录不存在，则显示提示信息，并退出</span></span><br><span class="line">    <span class="keyword">if</span> [ !<span class="params"> -d</span> <span class="variable">$output</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"输出文件的目录 <span class="variable">$output</span> 不存在"</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line">  h)</span><br><span class="line">    <span class="comment">#显示脚本使用信息</span></span><br><span class="line">    usage</span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">    ;;</span><br><span class="line">  :)</span><br><span class="line">    <span class="comment">#如果没有为需要参数的选项指定参数，则显示提示信息，并退出脚本的运行</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"选项 -<span class="variable">$OPTARG</span> 需要一个参数"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line">  \?)</span><br><span class="line">    <span class="comment">#如果指定的选项为无效选项，则显示提示信息，及脚本的使用方法信息，并退出脚本的运行</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"无效的选项 -<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    usage</span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行脚本如下</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -h</span></span><br><span class="line">当前脚本用法如下</span><br><span class="line">./<span class="built_in">test</span>.sh [-h] [-v] [-f &lt;filename&gt;] [-o &lt;filename&gt;]</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -vf</span></span><br><span class="line">选项<span class="params"> -f</span> 需要一个参数</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -vf /tmp/no</span></span><br><span class="line">输入的参数/tmp/no不存在</span><br></pre></td></tr></table></figure>

<h4 id="使用getopt处理多命令行选项"><a href="#使用getopt处理多命令行选项" class="headerlink" title="使用getopt处理多命令行选项"></a>使用getopt处理多命令行选项</h4><p><code>getopt</code>命令与<code>getopts</code>命令功能相似，也是用于解析命令行的选项和参数，不同的是<code>getopt</code>是linux下的命令行工具，并且支持命令行的长选项（–）另外，在脚本中调用方式也不同</p>
<p>使用getopt语法如下：</p>
<blockquote>
<p>getopt options – optstring parameters</p>
<p>getopt options -o|–options optstring options – parameters</p>
</blockquote>
<p>下面是一个getopt的例子</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getopt f:vl<span class="params"> -vl</span><span class="params"> -f</span>/<span class="built_in">local</span>/filename.conf param</span><br></pre></td></tr></table></figure>

<p>上例中，f:vl对应getopt语法中的optstring（选项字符串），”-vl -f/local/filename.conf param”对应语法中的parameters（命令的参数），因此getopt会按照optstring的设置，将paramteers解析为相应的选项和参数</p>
<p>所以上例子中，-vl被解析为-v和-l，f后面有一个冒号(:)所以-f/local/filename.conf被解析为”-f  /local/filename.conf”,然后解析后的命令行选项和参数之间使用双连字符（–）分隔</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-v<span class="params"> -l</span><span class="params"> -f</span> /<span class="built_in">local</span>/filename.conf<span class="params"> --param</span></span><br></pre></td></tr></table></figure>

<p>下面看一个shell脚本解析的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将getopt命令解析后的内容设置到位置参数</span></span><br><span class="line"><span class="built_in">set</span> -- `getopt f:vl <span class="string">"<span class="variable">$@</span>"</span>`</span><br><span class="line"><span class="comment">#如果位置参数个数大于0就执行while循环</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span><span class="params"> -gt</span> 0 ];</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -vl  -f/tmp/no testparam</span></span><br><span class="line">-v</span><br><span class="line">-l</span><br><span class="line">-f</span><br><span class="line">/tmp/no</span><br><span class="line">--</span><br><span class="line">testparam</span><br></pre></td></tr></table></figure>

<p>这是一个简单的通过位置参数循环解析命令行参数的例子，下面示例使用getopt来解析，下面脚本改编自上面getopts的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义变量vflag</span></span><br><span class="line">vflag=off</span><br><span class="line"><span class="comment">#定义变量filename</span></span><br><span class="line">filename=<span class="string">""</span></span><br><span class="line"><span class="comment">#定义变量output</span></span><br><span class="line">output=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用getopt命令处理后的命令行选项和参数重新设置位置参数</span></span><br><span class="line"><span class="built_in">set</span> -- `getopt hvf:o: <span class="string">"<span class="variable">$@</span>"</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义函数usage</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前脚本用法如下"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"./test.sh [-h] [-v] [-f &lt;filename&gt;] [-o &lt;filename&gt;]"</span></span><br><span class="line">  <span class="built_in">exit</span><span class="params"> -1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#如果位置参数的个数大于0就执行while循环</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span><span class="params"> -gt</span> 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="params">  -v</span>)</span><br><span class="line">    vflag=on</span><br><span class="line">    ;;</span><br><span class="line"><span class="params">  -f</span>)</span><br><span class="line">    <span class="comment">#将-f选项的参数赋值给filename</span></span><br><span class="line">    filename=<span class="variable">$2</span></span><br><span class="line">    <span class="comment">#如果文件不存在，则显示提示信息，并退出脚本的执行,否则将位置参数左移，移动到-f选项的参数的位置</span></span><br><span class="line">    <span class="keyword">if</span> [ !<span class="params"> -f</span> <span class="variable">$filename</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"输入的参数<span class="variable">$filename</span>不存在"</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="params">  -o</span>)</span><br><span class="line">    <span class="comment">#将-o选项的参数赋值给output</span></span><br><span class="line">    output=<span class="variable">$2</span></span><br><span class="line">    <span class="comment">#如果指定的输出文件的目录不存在，则显示提示信息，并退出，否则将位置参数左移，移动到-o选项的参数的位置</span></span><br><span class="line">    <span class="keyword">if</span> [ !<span class="params"> -d</span> <span class="variable">$output</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"输出文件的目录 <span class="variable">$output</span> 不存在"</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="params">  -h</span>)</span><br><span class="line">    <span class="comment">#显示脚本使用信息</span></span><br><span class="line">    usage</span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">    ;;</span><br><span class="line">  --)</span><br><span class="line">    <span class="comment">#如果是双连字符，则跳过，并退出while循环</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">    ;;</span><br><span class="line">  -*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"无效的选项 <span class="variable">$1</span>"</span></span><br><span class="line">    usage</span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行脚本结果如下</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -h</span></span><br><span class="line">当前脚本用法如下</span><br><span class="line">./<span class="built_in">test</span>.sh [-h] [-v] [-f &lt;filename&gt;] [-o &lt;filename&gt;]</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -vf</span></span><br><span class="line">getopt: option requires an argument -- <span class="string">'f'</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -vf /etc/passwd -o</span></span><br><span class="line">getopt: option requires an argument -- <span class="string">'o'</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -vf /etc/passwd -o /temp/no</span></span><br><span class="line">输出文件的目录 /temp/no 不存在</span><br></pre></td></tr></table></figure>

<p>getopt还有一个功能是支持长选项（–long-options）,下面通过一个例子来看下如何解析：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义变量param2</span></span><br><span class="line">param2=0</span><br><span class="line"><span class="comment">#使用getopt命令处理脚本的命令行选项和参数，再讲处理后的结果重新赋值给位置参数</span></span><br><span class="line"><span class="keyword">#eval</span>命令用于将其后的内容作为单个命令读取和执行，这里用于处理getopt命令生成的参数的转义字符</span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- `getopt<span class="params"> -o</span> a::bc:<span class="params"> --long</span> arga::,argb,argc:<span class="params"> -n</span> <span class="string">'test.sh'</span> -- <span class="string">"<span class="variable">$@</span>"</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行while循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line"><span class="params">    -a</span>|--arga)</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"<span class="variable">$2</span>"</span> <span class="keyword">in</span></span><br><span class="line">      <span class="string">""</span>)</span><br><span class="line">        <span class="comment">#当没有给具有可选参数的选项-a(或--arga)指定参数时，使用默认赋值给变量param1</span></span><br><span class="line">        param1=<span class="string">'default value'</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">      *)</span><br><span class="line">        <span class="comment">#当给具有可选参数的选项-a(或--arga指定了参数时，使用指定的参数赋值给变量param1)</span></span><br><span class="line">        param1=<span class="variable">$2</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">      <span class="keyword">esac</span></span><br><span class="line">      ;;</span><br><span class="line"><span class="params">  -b</span>|--argb)</span><br><span class="line">  <span class="comment">#如果指定了选项-b(或--argb)，则将变量param2赋值为1</span></span><br><span class="line">    param2=1</span><br><span class="line">    ;;</span><br><span class="line"><span class="params">    -c</span>|--argc)</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"<span class="variable">$2</span>"</span> <span class="keyword">in</span></span><br><span class="line">      <span class="string">""</span>)</span><br><span class="line">      <span class="comment">#如果为-c(或argc)选项没有指定参数，则跳过</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">      *)</span><br><span class="line">        <span class="comment">#如果为-c(或argc)选项指定了参数，则将指定的参数赋值给变量param3</span></span><br><span class="line">        param3=<span class="variable">$2</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">      <span class="keyword">esac</span></span><br><span class="line">      ;;</span><br><span class="line">  --)</span><br><span class="line">    <span class="comment">#如果为双连字符则退出while循环，表示选项的结束</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="comment">#若为其他选项，则显示错误信息，并退出</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"内部错误"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#打印变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"param1 = <span class="variable">$param1</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"param2 = <span class="variable">$param2</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"param3 = <span class="variable">$param3</span>"</span></span><br></pre></td></tr></table></figure>

<p>上述脚本中，我们使用getopt命令<code>getopt -o a::bc: --long arga::,argb,argc: -n &#39;test.sh&#39; -- &quot;$@&quot;</code>来处理指定给脚本的命令行参数。-o选项表示告诉getopt识别哪些短（一个字符）选项。–long（或-l）选项告诉getopt识别哪些长（多个字符）选项，-n选项告诉getopt在报告错误时使用什么文件名（或程序名）</p>
<p>getopt命令的-o选项所指定的选项字符串遵循如下规则：</p>
<ul>
<li>每个字符发表一个选项</li>
<li>字符后面跟一个冒号(:)表示选项需要一个参数，两个冒号(::)表示选项有个可选参数</li>
</ul>
<p>例如上面的脚本，”a::”表示识别选项-a，且-a具有一个可选参数，如果在命令行指定参数给-a选项，那么选项-a与参数之间不能有任何空格。”b”表示识别选项-b，没有参数，”c:”表示识别选项-c，有一个参数。下面看几个指定脚本短选项运行的示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -c 456</span></span><br><span class="line">param1 =</span><br><span class="line">param2 = 0</span><br><span class="line">param3 = 456</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -a123 -b -c 456</span></span><br><span class="line">param1 = 123</span><br><span class="line">param2 = 1</span><br><span class="line">param3 = 456</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh -a -b -c 456</span></span><br><span class="line">param1 = default value</span><br><span class="line">param2 = 1</span><br><span class="line">param3 = 456</span><br></pre></td></tr></table></figure>

<p>getopt命令的–long选项遵循如下规则：</p>
<ul>
<li>每个选项之间由逗号(,)分隔</li>
<li>字符串后面跟一个冒号(:)表示选项需要一个参数，跟两个冒号(::)表示有可选参数</li>
</ul>
<p>下面看几个指定脚本长选项运行的示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh --arga --argb --argc 456</span></span><br><span class="line">param1 = default value</span><br><span class="line">param2 = 1</span><br><span class="line">param3 = 456</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh --arga='123' --argb --argc 456</span></span><br><span class="line">param1 = 123</span><br><span class="line">param2 = 1</span><br><span class="line">param3 = 456</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh --argc 456</span></span><br><span class="line">param1 =</span><br><span class="line">param2 = 0</span><br><span class="line">param3 = 456</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh --arga 456</span></span><br><span class="line">param1 = default value</span><br><span class="line">param2 = 0</span><br><span class="line">param3 =</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># ./test.sh --argb 456</span></span><br><span class="line">param1 =</span><br><span class="line">param2 = 1</span><br><span class="line">param3 =</span><br></pre></td></tr></table></figure>

<h3 id="获得用户输入"><a href="#获得用户输入" class="headerlink" title="获得用户输入"></a>获得用户输入</h3><p>bash下通过内部命令<code>read</code>接收用户键盘的输入，并可以将输入的内容赋值给一个变量</p>
<h4 id="基本的读取"><a href="#基本的读取" class="headerlink" title="基本的读取"></a>基本的读取</h4><p>read命令基本读取的语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span><span class="params"> -p</span> prompt variable1 variable2</span><br></pre></td></tr></table></figure>

<p>-p选项用于输出提示信息，来提示用户输入，read命令会每次从标准输入或者（-u 指定的文件描述符中）读取一行内容，它会将第一个单词赋值给变量variable1，第二个赋值给变量variable2，以此类推。如果输入的单词少于指定的变量数，剩下的变量会被设为空，环境变量IFS中的字符作为分隔符来将输入的内容分隔为单词。下面是一个示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span><span class="params"> -p</span> <span class="string">"请输入您的用户名："</span> username</span><br><span class="line"><span class="built_in">read</span><span class="params"> -p</span> <span class="string">"请输入您的电话："</span> tel</span><br><span class="line"><span class="built_in">read</span><span class="params"> -p</span> <span class="string">"是否继续？[y/n]"</span> input</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$input</span> <span class="keyword">in</span></span><br><span class="line">[yY]*)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"您输入的用户名是：<span class="variable">$username</span>"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"您输入的电话号码是：<span class="variable">$tel</span>"</span></span><br><span class="line">  ;;</span><br><span class="line">[nN]*)</span><br><span class="line">  <span class="built_in">exit</span></span><br><span class="line">  ;;</span><br><span class="line">*)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"只能输入y或者n"</span></span><br><span class="line">  <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">./<span class="built_in">test</span>.sh</span><br><span class="line">请输入您的用户名：zhangsan</span><br><span class="line">请输入您的电话：123456</span><br><span class="line">是否继续？[y/n]y</span><br><span class="line">您输入的用户名是：zhangsan</span><br><span class="line">您输入的电话号码是：123456</span><br></pre></td></tr></table></figure>

<h4 id="输入超时"><a href="#输入超时" class="headerlink" title="输入超时"></a>输入超时</h4><p>通过-t选项可以指定在某个时间内输入，如果没有输入就超时退出，比如上面的脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span><span class="params"> -t</span> 5<span class="params"> -p</span> <span class="string">"请输入您的用户名："</span> username</span><br></pre></td></tr></table></figure>

<p>每个参数等待5秒，如果没有输入提示下一个参数，直到退出</p>
<h4 id="隐藏方式读取"><a href="#隐藏方式读取" class="headerlink" title="隐藏方式读取"></a>隐藏方式读取</h4><p>-s选项可以隐藏用户的输入，比如密码输入的时候，比如上面的脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span><span class="params"> -s</span><span class="params"> -p</span> <span class="string">"请输入您的用户名："</span> username</span><br></pre></td></tr></table></figure>

<h4 id="从文件中读取"><a href="#从文件中读取" class="headerlink" title="从文件中读取"></a>从文件中读取</h4><p>read命令从文件中读取数据的方法主要有两种：通过文件描述符一行一行的读取文件内容（本节不讲），一种是在循环中使用命令<code>cat filename</code>，其语法如下：</p>
<blockquote>
<p>for data in $(cat filename)</p>
<p>do</p>
<p>执行命令</p>
<p>done</p>
</blockquote>
<p>默认情况下这种方法是逐个单词的读取文件内容，因为在读取时它以环境变量IFS的值为分隔符，默认值为空格|tab|newline，所以默认回以空格为界限读取，如果想要一次读取一行需要修改环境变量IFS的值。下面演示一个循环按行读取文件内容的例子</p>
<p>首先创建一个文件at.txt如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 3 5 7 9</span><br><span class="line">2 4 6 8 0</span><br><span class="line">a b c d e</span><br></pre></td></tr></table></figure>

<p>其次，构建如下脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用临时变量保存$IFS的值</span></span><br><span class="line">tmp=<span class="variable">$IFS</span></span><br><span class="line"><span class="comment">#如果指定的命令行参数个数不为1，则显示脚本的使用方法，然后退出</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span><span class="params"> -ne</span> 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前脚本使用方法为：<span class="variable">$0</span> filename"</span></span><br><span class="line">  <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#如果指定的文件不存在，则显示提示信息，并退出脚本执行，退出状态码为1</span></span><br><span class="line"><span class="keyword">if</span> [ !<span class="params"> -f</span> <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前文件<span class="variable">$1</span>不存在"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#修改环境变量IFS的值，以换行符为分隔读取文件</span></span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"><span class="comment">#使用for循环来读取文件的内容，将读取的内容存入变量line</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> $(cat <span class="variable">$1</span>) ; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#恢复环境变量的值</span></span><br><span class="line">IFS=<span class="variable">$tmp</span></span><br></pre></td></tr></table></figure>

<p>执行脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./<span class="built_in">test</span>.sh at.txt</span><br><span class="line">1 3 5 7 9</span><br><span class="line">2 4 6 8 0</span><br><span class="line">a b c d e</span><br><span class="line">./<span class="built_in">test</span>.sh a.txt</span><br><span class="line">当前文件a.txt不存在</span><br></pre></td></tr></table></figure>

<p>假如上面脚本中我们不修改环境变量IFS的值，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果指定的命令行参数个数不为1，则显示脚本的使用方法，然后退出</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span><span class="params"> -ne</span> 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前脚本使用方法为：<span class="variable">$0</span> filename"</span></span><br><span class="line">  <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#如果指定的文件不存在，则显示提示信息，并退出脚本执行，退出状态码为1</span></span><br><span class="line"><span class="keyword">if</span> [ !<span class="params"> -f</span> <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"当前文件<span class="variable">$1</span>不存在"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#使用for循环来读取文件的内容，将读取的内容存入变量line</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> $(cat <span class="variable">$1</span>) ; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>再次执行脚本如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./<span class="built_in">test</span>.sh at.txt</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">7</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>使用while循环也可以读取文件内容，但是会消除每行原有的格式，去掉重复的空格和制表符，而将for循环结合环境变量$IFS使用可以保留每行原有的格式，按照自己的需求来决定使用哪种方式。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-08-25T12:19:30.000Z" itemprop="dateUpdated">2020-08-25 20:19:30</time>
</span><br>


        
        每天一点成长，一点收获
        
    </div>
    
    <footer>
        <a href="https://www.enjoyican.com">
            <img src="/img/head.jpg" alt="enjoycodingfun">
            enjoycodingfun
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.enjoyican.com/posts/shell-txt/&title=《shell中使用正则及脚本输入处理》 — Running&pic=https://www.enjoyican.com/img/head.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.enjoyican.com/posts/shell-txt/&title=《shell中使用正则及脚本输入处理》 — Running&source=这篇博文接前面两篇介绍shell中使用正则和shell脚本输入处理，有问题及时在本文下或CSDN留言。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.enjoyican.com/posts/shell-txt/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《shell中使用正则及脚本输入处理》 — Running&url=https://www.enjoyican.com/posts/shell-txt/&via=https://www.enjoyican.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.enjoyican.com/posts/shell-txt/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/posts/shell-grammar/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">shell语法基础</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "ulrMiFi5yrRdTGP8FEHMehcm-gzGzoHsz",
            appKey: "JjlHLHV0knhiDfaMJgjSgdYz",
            avatar: "mm",
            placeholder: "写点什么吧(*￣︶￣)",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢关注~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechatpay.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechatpay.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">CC BY-NC-SA 4.0</a>协议 转载请注明出处</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>enjoycodingfun &copy; 2015 - 2020</span>
            <span>
                
                <a href="http://www.beian.miit.gov.cn" target="_blank">浙ICP备20006880号-1</a><br>
                
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.enjoyican.com/posts/shell-txt/&title=《shell中使用正则及脚本输入处理》 — Running&pic=https://www.enjoyican.com/img/head.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.enjoyican.com/posts/shell-txt/&title=《shell中使用正则及脚本输入处理》 — Running&source=这篇博文接前面两篇介绍shell中使用正则和shell脚本输入处理，有问题及时在本文下或CSDN留言。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.enjoyican.com/posts/shell-txt/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《shell中使用正则及脚本输入处理》 — Running&url=https://www.enjoyican.com/posts/shell-txt/&via=https://www.enjoyican.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.enjoyican.com/posts/shell-txt/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABz0lEQVR42u3ayw7CMAxE0f7/T5dtJWg6M47TIN2sUID2ZGP5keOQ13lZ3zt3+9edu2ceHQsuXLhl7jlcOkLfUQ7//Ru4cOGu544Dzfjz+AXjfTvYwYUL90+4eqiakAbBhQt3S64e2txSCi5cuLtxleJHaZG43YzGWg0uXLgFrt6l7Pvc0t+FCxduxD3NVUlTlDLp4e1w4cJdwtUDitL0dMNf+F64cOEu4bqFkIur368oXcWACxeuya1fonLHKnor5CEjgwsXbhs3a5vqRY5LMRoocOHCbeO6lCxNcVsht8+BCxfuS1w3NVEuZ2Sjmof+DVy4cNu4+iOUb7MEqPJMuHDhdnD1hoXyyqzIMQ4GFy7chdxsCJoNWtxj2MUPXLhwy9ysCHHHKm4ZYwxr4cKF28Z1k5tZx3CHMXDhwn2Lq4QhfUxST55+COHChbuQ616MUBqjRm6lj2HgwoXbzD3NpbPG/wqHqXDhwl3CzS5aKYfRh7JK4WQfBi5cuGVuluJkbRQ3FE7LyODChRtx66MRvSiaUKvBhQt3M66b9LgXv8KuCVy4cDfgZiVN1v54mPzAhQu3jdsXjJTmqZJUwYULdyXXDSWV4WtWCMGFC3ch9wOorZp5lI2GKAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b9131a5ca31e54205078b286dad06616";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
  (function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'
    } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js'
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s)
  })();
</script>

    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '欢迎再来！';
            clearTimeout(titleTime);
        } else {
            document.title = '悦码小站';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
