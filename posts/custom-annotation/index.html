<!DOCTYPE html>
<html>
<head>
    

    
<!-- Tencent Speed -->
<script>var _speedMark = new Date()</script>
<!-- End Tencent Speed -->
<!-- Tencent Analysis -->
<script async src="//tajs.qq.com/stats?sId=66530752"></script>
<!-- End Tencent Analysis -->


    


<!-- Baidu Push -->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- End Baidu Push -->


    <meta charset="utf-8">
    
    
    
    <link rel="canonical" href="https://www.enjoyican.com//posts/custom-annotation/">
    
    
    <title>spring中自定义注解 | Running | Better Late Than Never</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="aop,annotion">
    <meta name="description" content="自定义注解在项目开发过程中非常有用，当框架提供的注解无法满足我们的业务逻辑需求时会需要我们自定义注解，了解自定义注解之前需要先了解元注解，即所谓注解的注解，本文不详聊元注解的概念，简单粗暴上示例代码演示几种常见的自定义注解方式，想了解元注解的可以查看JAVA编程思想第四版第二十章注解一章，或者直接网上找博客内容会有很多，下面开始正文。 Controller层注解-结合spring拦截器自定义注解针">
<meta property="og:type" content="article">
<meta property="og:title" content="spring中自定义注解">
<meta property="og:url" content="https://www.enjoyican.com/posts/custom-annotation/index.html">
<meta property="og:site_name" content="Running">
<meta property="og:description" content="自定义注解在项目开发过程中非常有用，当框架提供的注解无法满足我们的业务逻辑需求时会需要我们自定义注解，了解自定义注解之前需要先了解元注解，即所谓注解的注解，本文不详聊元注解的概念，简单粗暴上示例代码演示几种常见的自定义注解方式，想了解元注解的可以查看JAVA编程思想第四版第二十章注解一章，或者直接网上找博客内容会有很多，下面开始正文。 Controller层注解-结合spring拦截器自定义注解针">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/annotion1.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/2.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/3.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/4.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/5.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/6.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/7.png">
<meta property="og:image" content="https://www.enjoyican.com/img/custom-annotion/8.png">
<meta property="article:published_time" content="2020-04-06T07:33:57.500Z">
<meta property="article:modified_time" content="2020-04-06T07:33:57.500Z">
<meta property="article:author" content="enjoycodingfun">
<meta property="article:tag" content="aop">
<meta property="article:tag" content="annotion">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.enjoyican.com/img/custom-annotion/annotion1.png">
    
        <link rel="alternate" type="application/atom+xml" title="Running" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/timg.jpg">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/head.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">enjoycodingfun</h5>
          <a href="mailto:17364562230@163.com" title="17364562230@163.com" class="mail">17364562230@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/enjoycodingfun" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://blog.csdn.net/u010408502" target="_blank" rel="noopener"  >
                <i class="icon icon-lg icon-link"></i>
                CSDN
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/img/mywechat.png"  >
                <i class="icon icon-lg icon-wechat"></i>
                微信
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">spring中自定义注解</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">spring中自定义注解</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-06T07:33:57.500Z" itemprop="datePublished" class="page-time">
  2020-04-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/spring/">spring</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>大纲</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Controller层注解-结合spring拦截器自定义注解"><span class="post-toc-text">Controller层注解-结合spring拦截器自定义注解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-自定义注解"><span class="post-toc-text">1. 自定义注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-自定义拦截器处理注解"><span class="post-toc-text">2. 自定义拦截器处理注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-将自定义拦截器注册进webMvc拦截器链并定义拦截路由"><span class="post-toc-text">3.  将自定义拦截器注册进webMvc拦截器链并定义拦截路由</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-编写测试Controller类"><span class="post-toc-text">4. 编写测试Controller类</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Service层注解-结合SpringAOP自定义注解"><span class="post-toc-text">Service层注解-结合SpringAOP自定义注解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-自定义注解-1"><span class="post-toc-text">1. 自定义注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-自定义切面处理注解"><span class="post-toc-text">2.自定义切面处理注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-测试注解"><span class="post-toc-text">3.  测试注解</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参数校验型自定义注解"><span class="post-toc-text">参数校验型自定义注解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-自定义注解-2"><span class="post-toc-text">1.自定义注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-定义-Constraint中用到的校验规则类"><span class="post-toc-text">2.定义@Constraint中用到的校验规则类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-定义对应的子类重写父类中的方法-即相关的校验逻辑"><span class="post-toc-text">3.定义对应的子类重写父类中的方法,即相关的校验逻辑</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-注解的使用"><span class="post-toc-text">4.注解的使用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#总结"><span class="post-toc-text">总结</span></a></li></ol>
        </nav>
    </aside>


<article id="post-custom-annotation"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">spring中自定义注解</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-06 15:33:57" datetime="2020-04-06T07:33:57.500Z"  itemprop="datePublished">2020-04-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/spring/">spring</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>自定义注解在项目开发过程中非常有用，当框架提供的注解无法满足我们的业务逻辑需求时会需要我们自定义注解，了解自定义注解之前需要先了解元注解，即所谓注解的注解，本文不详聊元注解的概念，简单粗暴上示例代码演示几种常见的自定义注解方式，<strong>想了解元注解的可以查看</strong><code>JAVA编程思想第四版第二十章注解一章</code>，或者直接网上找博客内容会有很多，下面开始正文。</p>
<h2 id="Controller层注解-结合spring拦截器自定义注解"><a href="#Controller层注解-结合spring拦截器自定义注解" class="headerlink" title="Controller层注解-结合spring拦截器自定义注解"></a>Controller层注解-结合spring拦截器自定义注解</h2><p>针对controller层的注解，我们一般可以采用自定义注解结合spring拦截器的方式：</p>
<h3 id="1-自定义注解"><a href="#1-自定义注解" class="headerlink" title="1. 自定义注解"></a>1. 自定义注解</h3><p>首先你需要自定义一个注解，注解的定义采用关键字<code>@interface</code>来定义，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关于元注解的知识可以网上查看资料</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="comment">//该注解只用在方法上，用在其他地方的可以查看元注解的其他枚举值，不赘述</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyselfAnnotion &#123;</span><br><span class="line">    <span class="comment">//注解的变量支持基本数据类型，字符串，枚举，以及对应的数组类型</span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> "guanyu"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 18</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isHero</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">    String[] bros() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-自定义拦截器处理注解"><a href="#2-自定义拦截器处理注解" class="headerlink" title="2. 自定义拦截器处理注解"></a>2. 自定义拦截器处理注解</h3><p>当你定义好了注解后，你需要自定义处理该注解的拦截器，在拦截器中进行业务的处理，自定义拦截器实现spring提供的接口HandlerInterceptor即可，如下</p>
<p>spring提供的拦截器接口如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//请求发送到Controller之前调用</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//请求发送到Controller之后调用</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//完成请求的处理的回调方法</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到spring提供的拦截器接口主要有三个方法，分别用来处理不同阶段的请求，按照自己项目的需要重写其中的方法即可，比如有时候在controller你需要自定义一个注解来检测用户是否登录，登录之后将用户信息存在threadLocal中供后续调用，那么你可以在<code>preHandle</code>方法中实现相应的业务逻辑，当一次请求完成之后，你又需要将threadlocal中的信息remove掉，那么你可以在<code>afterCompletion</code>方法中进行释放，本例子中展示简单的在请求发送到controller之前的处理，因此只重写<code>preHandle</code>方法,如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotionInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> HandlerMethod)&#123;</span><br><span class="line">            HandlerMethod method = (HandlerMethod) handler;</span><br><span class="line">            <span class="comment">//1获取方法上的注解</span></span><br><span class="line">            MyselfAnnotion methodAnnotation = method.getMethodAnnotation(MyselfAnnotion<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="comment">//2获取类上的注解</span></span><br><span class="line">            <span class="comment">//MyselfAnnotion annotation = method.getBeanType().getAnnotation(MyselfAnnotion.class);</span></span><br><span class="line">            <span class="comment">//3获取类中属性的注解</span></span><br><span class="line">            <span class="comment">/*Field[] declaredFields = method.getBeanType().getDeclaredFields();</span></span><br><span class="line"><span class="comment">            for (Field field:declaredFields)&#123;</span></span><br><span class="line"><span class="comment">                field.setAccessible(true);</span></span><br><span class="line"><span class="comment">                MyselfAnnotion annotation = field.getAnnotation(MyselfAnnotion.class);</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == methodAnnotation)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (MyAnnotionEnum.GUANYU.getName().equals(methodAnnotation.name()))&#123;</span><br><span class="line">                System.out.println(<span class="string">"拦截器检测到是五虎上将"</span> + methodAnnotation.name());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"拦截器检测到不是关羽，是"</span>+ methodAnnotation.name() +<span class="string">"不能通关"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (MyAnnotionEnum.GUANYU.getAge().equals(methodAnnotation.age()))&#123;</span><br><span class="line">                System.out.println(<span class="string">"拦截器检测到这是18岁的关羽，威猛，过关"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"拦截器检测到这个关羽老了，不能通关"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拦截器中用到的枚举类</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MyAnnotionEnum &#123;</span><br><span class="line">    LIUBEI(<span class="string">"liubei"</span>,<span class="number">48</span>),</span><br><span class="line">    ZHANGFEI(<span class="string">"zhangfei"</span>,<span class="number">24</span>),</span><br><span class="line">    GUANYU(<span class="string">"guanyu"</span>,<span class="number">18</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面自定义的拦截器中，在preHandle方法中有如下的逻辑，首先获取判定该handler是否是handlermethod实例,关于handlermethod可以理解为存储着controller中每个@RequestMapping注解方法的对象，可以上官网了解下：<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">springmvc</a>，这里简单说下理解：</p>
<p><code>Spring MVC</code>应用启动时会搜集并分析每个Web控制器方法，从中提取对应的<code>&quot;&lt;请求匹配条件,控制器方法&gt;&quot;</code>映射关系，形成一个映射关系表保存在一个<code>RequestMappingHandlerMapping bean</code>中。然后在客户请求到达时，再使用<code>RequestMappingHandlerMapping</code>中的该映射关系表找到相应的控制器方法去处理该请求。在<code>RequestMappingHandlerMapping</code>中保存的每个<code>”&lt;请求匹配条件,控制器方法&gt;&quot;</code>映射关系对儿中,”请求匹配条件”通过<code>RequestMappingInfo</code>包装和表示，而”控制器方法”则通过<code>HandlerMethod</code>来包装和表示。(<strong>想了解这部分内容的可以查看spring技术内幕-计文柯第二版中p166，第4.4.4小节 Mvc处理HTTP分发请求这一小节，也可以看看spring源码深度解析-郝佳一书中p291，第11章 springmvc</strong>)</p>
<p>一个<code>HandlerMethod</code>对象，可以认为是对如下信息的一个包装 :<br><code>Object bean</code>    Web控制器方法所在的Web控制器bean。可以是字符串，代表bean的名称;也可以是bean实例对象本身。<br><code>Class beanType</code>    Web控制器方法所在的Web控制器bean的类型,如果该bean被代理，这里记录的是被代理的用户类信息<br><code>Method method</code>    Web控制器方法<br><code>Method bridgedMethod</code>    被桥接的Web控制器方法<br><code>MethodParameter[] parameters</code>    Web控制器方法的参数信息:所在类所在方法,参数,索引,参数类型<br><code>HttpStatus responseStatus</code>    注解@ResponseStatus的code属性<br><code>String responseStatusReason</code>    注解@ResponseStatus的reason属性</p>
<p>如果该handler是handlermethod实例，则判断是否有自定义注解<code>MyselfAnnotion</code>在方法上，如果没有直接返回true放行，如果有继续判断注解中name是否关羽，是否年龄18，两者都满足就放行，不满足则不放行。</p>
<h3 id="3-将自定义拦截器注册进webMvc拦截器链并定义拦截路由"><a href="#3-将自定义拦截器注册进webMvc拦截器链并定义拦截路由" class="headerlink" title="3.  将自定义拦截器注册进webMvc拦截器链并定义拦截路由"></a>3.  将自定义拦截器注册进webMvc拦截器链并定义拦截路由</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注册拦截器，拦截特定请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotionInterceptorConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入自定义的拦截器</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyAnnotionInterceptor myAnnotionInterceptor;</span><br><span class="line">    <span class="comment">//注册拦截器并定义拦截路由</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(myAnnotionInterceptor).addPathPatterns(<span class="string">"/testMyselfAnno/**"</span>);</span><br><span class="line">        <span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，结合拦截器自定义的注解已经完成，可以编写测试类controller测试下，如下：</p>
<h3 id="4-编写测试Controller类"><a href="#4-编写测试Controller类" class="headerlink" title="4. 编写测试Controller类"></a>4. 编写测试Controller类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testMyselfAnno/no"</span>)</span><br><span class="line">  <span class="meta">@MyselfAnnotion</span>(name = <span class="string">"guanyu"</span>, age = <span class="number">50</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyAnnotion1</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"虽然是关羽，但是年龄大了，没通过校验"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/yes"</span>)</span><br><span class="line">  <span class="meta">@MyselfAnnotion</span>(name = <span class="string">"guanyu"</span>, age = <span class="number">50</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyAnnotion2</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"虽然有注解，但是路径不属于拦截范围，通过校验,进入方法体"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/testMyselfAnno/liubei/no"</span>)</span><br><span class="line">  <span class="meta">@MyselfAnnotion</span>(name = <span class="string">"liubei"</span>, age = <span class="number">48</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyAnnotion3</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"不是关羽，无法通过校验"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/testMyselfAnno/defaultyes"</span>)</span><br><span class="line">  <span class="meta">@MyselfAnnotion</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyAnnotion4</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"注解默认值是关羽，而且很年轻，通过校验，进入方法体"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>我们依次在<code>postman</code>上访问对应的接口（或者通过spring-test包的mockmvc去mock）查看对应结果：</p>
<p>1）访问方法testMyAnnotion1上的路由 /testMyselfAnno/no</p>
<p>首先该路径能够匹配上我们在配置中配的要拦截的路径，且该方法上含有<code>@MyselfAnnotion</code>自定义注解，其中name的确是关羽，所以在拦截器处理时会打印出<code>&quot;拦截器检测到是五虎上将guanyu&quot;</code>,之后判定年龄，由于注解中年龄为50，拦截器处理时会打印出<code>&quot;拦截器检测到这个关羽老了，不能通关&quot;</code>,之后返回false，不会走进方法中的具体打印。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/annotion1.png" alt="访问接口1" title="">
                </div>
                <div class="image-caption">访问接口1</div>
            </figure>

<p>其他例子也可自行分析后自测体验下。</p>
<h2 id="Service层注解-结合SpringAOP自定义注解"><a href="#Service层注解-结合SpringAOP自定义注解" class="headerlink" title="Service层注解-结合SpringAOP自定义注解"></a>Service层注解-结合SpringAOP自定义注解</h2><h3 id="1-自定义注解-1"><a href="#1-自定义注解-1" class="headerlink" title="1. 自定义注解"></a>1. 自定义注解</h3><p>注解还是采用上文中的注解@MyselfAnnotion</p>
<h3 id="2-自定义切面处理注解"><a href="#2-自定义切面处理注解" class="headerlink" title="2.自定义切面处理注解"></a>2.自定义切面处理注解</h3><p>在自定义切面之前，先在之前的Controller层新增加一个接口如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotionTestController</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyAnnotionTestService myAnnotionTestService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/aop"</span>)</span><br><span class="line">    <span class="meta">@MyselfAnnotion</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyAnnotion5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我来自Controller层，我用来测试自定义注解"</span>);</span><br><span class="line">        myAnnotionTestService.testAopAnnotion();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后定义service层接口及实现类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyAnnotionTestService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testAopAnnotion</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实现类</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotionTestServiceImpl</span> <span class="keyword">implements</span> <span class="title">MyAnnotionTestService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@MyselfAnnotion</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAopAnnotion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我来自service层，我用来测试自定义注解"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于本案例展示service层的注解与AOP切面的结合，所以暂时在示例时指定切点表达式具体到service层，下面定义切面，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyselfAnnotionAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">//通过切点表达式定义切点</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.enjoyican.demo.selfannotion.service.impl..*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myPointCut</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"@annotation(MyselfAnnotion)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAnnoCut</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义方法增强类型（本例子采用环绕增强）</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"myAnnoCut()&amp;&amp;myPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"AOP切面在执行service方法之前增强"</span>);</span><br><span class="line">        point.proceed();</span><br><span class="line">        System.out.println(<span class="string">"AOP切面在执行service方法之后增强"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先上面的切面定义了两个切点，一个是定义到<code>service.impl</code>包下,另一个定义成带有注解<code>MyselfAnnotion</code>的类，然后定义一个环绕增强，切点表达式采用两者结合即可定位到对应的service层下面打了<code>@MyselfAnnotion</code>注解的类中（本例子之所以这么定义是为了稍后演示方便，切点表达式也可以合成一个，后面我会专门说下spring中切点表达式的案例的）</p>
<p>现在的IDEA智能提示非常方便，当你的切面定义好后，在增强方法对应地方光标会显示增强了哪些方法，比如按照我上面的写法，会出现如下提示：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/2.png" alt="IDEA提示" title="">
                </div>
                <div class="image-caption">IDEA提示</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/3.png" alt="IDEA提示" title="">
                </div>
                <div class="image-caption">IDEA提示</div>
            </figure>

<h3 id="3-测试注解"><a href="#3-测试注解" class="headerlink" title="3.  测试注解"></a>3.  测试注解</h3><p>如上面切面定义好了，在切面中我们做了一件事就是在执行service方法的前后打印了两句话（在实际业务中可以是在执行service方法前后进行一些处理，比如打印入参，返回值或其他功能），接下来通过postman跑下对应的接口，得到如下响应：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/4.png" alt="注解响应" title="">
                </div>
                <div class="image-caption">注解响应</div>
            </figure>

<p>可以看到虽然我们在controller层和service层都加了<code>@MyselfAnnotion</code>注解，但是我们切面只处理service层的，所以在打印controller层的“我来自Controller层，我用来测试自定义注解”这句话的前后并没有进行增强，而service按照我们想的进行了方法增强。</p>
<p>上面举的例子比较简单，实际业务中将注解用到service层某些方法之上来实现我们的业务逻辑的情况很常见，相比仅仅用切面去控制，通过一个注解控制的力度更细更灵活一些，也更方便操作。</p>
<p>另外本例中虽然以在service层通过注解加AOP的形式来自定义注解处理业务逻辑，但实际上controller层的有些场景也可以用aop来控制，并不是必须要采用拦截器，这个要看你具体想获取的是哪些信息以及需要在哪个阶段增强有关，如果用aop控制的话也就是切点表达式怎么写的问题。</p>
<p>比如，在上面例子中，加入将环绕增强变成如下形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义方法增强类型（本例子采用环绕增强）</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"myAnnoCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"AOP切面在执行service方法之前增强"</span>);</span><br><span class="line">        point.proceed();</span><br><span class="line">        System.out.println(<span class="string">"AOP切面在执行service方法之后增强"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>此时我们的增强对象是所有打了<code>@MyselfAnnotion</code>注解的方法，因此这个情况下controller层的方法也会被增强，此时IDEA的提示也会显示出来，如下图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/5.png" alt="IDEA提示" title="">
                </div>
                <div class="image-caption">IDEA提示</div>
            </figure>

<p>因为此时被增强的方法多了，所以点击时候会显示都有哪些被增强。此时我们再访问刚才的接口，得到的响应如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/6.png" alt="注解响应" title="">
                </div>
                <div class="image-caption">注解响应</div>
            </figure>

<p>可看到在controller和service层方法执行前后，都被增强了（<strong>忽略上面AOP提示中都是显示service增强</strong>）</p>
<h2 id="参数校验型自定义注解"><a href="#参数校验型自定义注解" class="headerlink" title="参数校验型自定义注解"></a>参数校验型自定义注解</h2><p>在开发过程中，还有一类注解不得不提，就是通常用来对方法入参进行校验的注解。对方法入参进行校验，当然也可以通过aop来处理，通过获取属性上的注解，进行判定。在springmvc中，我们借助常用的hibernate-validator即可实现大部分入参的校验，<strong>关于使用hibernate-validator进行校验的知识，可以参考<a href="http://hibernate.org/validator/" target="_blank" rel="noopener">官方文档</a>或者从网上搜索相关资源即可，本小结不对此做特别说明，也可以看下如下博客<a href="https://blog.csdn.net/fred_lzy/article/details/81099699" target="_blank" rel="noopener">基于注解校验入参</a></strong>，<strong><a href="https://spldeolin.com/posts/spring-component-validated/" target="_blank" rel="noopener">spring组件参数校验</a></strong></p>
<p>有时候我们的需求在现有的注解中可能没找到合适的，这时候可能需要我们自定义注解 ，本例子中说明一个自定义校验入参中枚举值是否符合现有枚举值的自定义注解，前置知识可以看下<a href="https://blog.csdn.net/lwg_1540652358/article/details/84193759" target="_blank" rel="noopener">这篇博客</a></p>
<h3 id="1-自定义注解-2"><a href="#1-自定义注解-2" class="headerlink" title="1.自定义注解"></a>1.自定义注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">//注意这个注解</span></span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = &#123;ValidEnumValueValidator<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Target</span>(</span>&#123;METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ValidEnumValue &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "不是有效的枚举值"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	<span class="comment">//这里的ValidityInterpretable接口在后面定义</span></span><br><span class="line">    Class&lt;? extends ValidityInterpretable&gt; enumType();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-定义-Constraint中用到的校验规则类"><a href="#2-定义-Constraint中用到的校验规则类" class="headerlink" title="2.定义@Constraint中用到的校验规则类"></a>2.定义@Constraint中用到的校验规则类</h3><p>在本例中即为<code>ValidEnumValueValidator</code>，注意需要实现<code>ConstraintValidator&lt;ValidEnumValue, Integer&gt;</code>接口，泛型接口中的两个参数一个是自定义的注解<code>ValidEnumValue</code>，另外一个为自定义的校验注解中校验值的类型，根据实际业务需要确定</p>
<p>定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidEnumValueValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">ValidEnumValue</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ValidityInterpretable validityInterpretable;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isEmpty;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ValidEnumValue constraintAnnotation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//初始化加载所有枚举类</span></span><br><span class="line">        ValidityInterpretable[] enumConstants = constraintAnnotation.enumType().getEnumConstants();</span><br><span class="line">        <span class="keyword">if</span> (enumConstants.length == <span class="number">0</span>) &#123;</span><br><span class="line">            isEmpty = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        validityInterpretable = enumConstants[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断有效性的具体逻辑由子类重写</span></span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> validityInterpretable.isValid(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-定义对应的子类重写父类中的方法-即相关的校验逻辑"><a href="#3-定义对应的子类重写父类中的方法-即相关的校验逻辑" class="headerlink" title="3.定义对应的子类重写父类中的方法,即相关的校验逻辑"></a>3.定义对应的子类重写父类中的方法,即相关的校验逻辑</h3><p>首先定义注解中用到的<code>ValidityInterpretable</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ValidityInterpretable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断value对该enum而言是否是有效的枚举值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Integer value)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其次定义一个子类实现该接口，重写校验的方法，该子类为我们枚举值定义的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> IdolOrderEnum implements ValidityInterpretable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 蔡徐坤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CAI_XU_KUN(<span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 陈立农</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CHEN_LI_NONG(<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 范丞丞</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    FAN_CHEN_CHEN(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer value;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Integer value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(values()).anyMatch(one -&gt; one.getValue().equals(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的枚举我们定义了一个偶像排名的枚举类（此处引用偶像练习生ninepercent出道排名，没别的原因，仅仅是今天微博热搜上看到的），其中提供了一个<code>isValid</code>方法用来校验所有的枚举值value中有没有与我传入的value相同的，有说明该入参符合规范，没有说明入参不符合规矩，下面编写一个测试类来说明</p>
<h3 id="4-注解的使用"><a href="#4-注解的使用" class="headerlink" title="4.注解的使用"></a>4.注解的使用</h3><p>注解的使用，在入参dto中需要校验字段有效性的地方，打上自定义的注解，来判断前端或者api调用中对方传来的参数是否符合要求：</p>
<p>首先定义一个入参DTO对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRequest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="comment">//此处打上对应的注解，注明校验的枚举类</span></span><br><span class="line">    <span class="meta">@ValidEnumValue</span>(enumType = IdolOrderEnum<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">Integer</span> <span class="title">order</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后依然采用之前的<code>MyAnnotionTestController</code>在其中添加一个方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test/validator"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyAnnotion6</span><span class="params">(@RequestBody @Valid MyRequest request, BindingResult result)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors())&#123;</span><br><span class="line">            List&lt;FieldError&gt; fieldErrors = result.getFieldErrors();</span><br><span class="line">            <span class="keyword">for</span> (FieldError error : fieldErrors) &#123;</span><br><span class="line">                <span class="comment">//可以返回具体的错误异常</span></span><br><span class="line">                System.out.println(error.getField()+error.getDefaultMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"测试入参校验自定义注解,入参："</span>+request.toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>之后用postman访问，加入我们传入一个枚举中没有的值，order=4，就会无法通过校验，如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/7.png" alt="注解响应" title="">
                </div>
                <div class="image-caption">注解响应</div>
            </figure>

<p>如果我们传入正确的值，就会通过校验，执行方法后面的代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://www.enjoyican.com/img/custom-annotion/8.png" alt="注解响应" title="">
                </div>
                <div class="image-caption">注解响应</div>
            </figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上总结了结合拦截器，aop，以及@Constraint注解来处理自定义注解的案例，在实际开发中自定义注解是比较有用的，可以方便我们开发。需要注意的是，自定义注解的使用并不是一定要结合上面三种情况，我们知道注解通过反射可以拿到，那么有时候我们在类属性字段上的注解只需要通过反射获取之后，进行对应的判定和业务逻辑处理即可。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-04-06T07:33:57.500Z" itemprop="dateUpdated">2020-04-06 15:33:57</time>
</span><br>


        
        每天一点成长，一点收获
        
    </div>
    
    <footer>
        <a href="https://www.enjoyican.com">
            <img src="/img/head.jpg" alt="enjoycodingfun">
            enjoycodingfun
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/annotion/" rel="tag">annotion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aop/" rel="tag">aop</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.enjoyican.com/posts/custom-annotation/&title=《spring中自定义注解》 — Running&pic=https://www.enjoyican.com/img/head.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.enjoyican.com/posts/custom-annotation/&title=《spring中自定义注解》 — Running&source=悟已往之不谏，知来者之可追" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.enjoyican.com/posts/custom-annotation/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《spring中自定义注解》 — Running&url=https://www.enjoyican.com/posts/custom-annotation/&via=https://www.enjoyican.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.enjoyican.com/posts/custom-annotation/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/posts/design-pattern/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">转载-设计模式也可以这么简单</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "ulrMiFi5yrRdTGP8FEHMehcm-gzGzoHsz",
            appKey: "JjlHLHV0knhiDfaMJgjSgdYz",
            avatar: "mm",
            placeholder: "写点什么吧(*￣︶￣)",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢关注~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechatpay.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechatpay.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">CC BY-NC-SA 4.0</a>协议 转载请注明出处</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>enjoycodingfun &copy; 2015 - 2020</span>
            <span>
                
                <a href="http://www.beian.miit.gov.cn" target="_blank">浙ICP备20006880号-1</a><br>
                
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.enjoyican.com/posts/custom-annotation/&title=《spring中自定义注解》 — Running&pic=https://www.enjoyican.com/img/head.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.enjoyican.com/posts/custom-annotation/&title=《spring中自定义注解》 — Running&source=悟已往之不谏，知来者之可追" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.enjoyican.com/posts/custom-annotation/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《spring中自定义注解》 — Running&url=https://www.enjoyican.com/posts/custom-annotation/&via=https://www.enjoyican.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.enjoyican.com/posts/custom-annotation/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3awXLCMAxFUf7/p9N1B+LcJ1Fo5OsVU4Lj44VqS3o88DhOxvp58u3z5/VvW0OGDBm3ZRzLcfaC9GVkZv7ti7fLkCFjA0YaFs9+y4MyR6KALkOGDBnLIEjmOQOn2yRDhgwZtddw2Docf/n/hgwZMv49I10QCal8iek2yZAhYzcGv2R+/vOf1DdkyJBxK8YRDnIpJeUEHlLRqmTIkDGawQNcv5uDHz2L65EhQ8ZQBk/Zr5/pHPVq7ypWHmTIkDGUkQZNzusUJ379RYYMGaMZZLq0PNkpc5JNibODMmTIGMRIy5ZpZp43W6RBX4YMGbMZneQ+T8bxo2TrEitDhoyhjDThlR4T08twbR4ZMmTswHjXrTBNw3USavEVV4YMGbdl8FRXWsgkaTVe2gy6RWTIkDGU0U/io3xeI/ZfbJ8MGTJGM2phLj3A1a7HaSOaDBkyZjM6Rce0ISNlF9ssZMiQMYjB0/GdJfImjJQqQ4aMHRi8b4EsKC1tpu0XcTiWIUPGIEba4lBLnHWSd+j4KEOGjA0YnZYsHqDfVQBonXNlyJBxcwYPc/32rzgvuN4aGTJkDGUc4UhJnfJAMKcMGTJGM2phLj32dXhk+2TIkLEDo19iTJP7PDFXbLmQIUPGUEYn8NWyXrWj3sVdXIYMGTIaF8ja1fdDAVeGDBnjGLWFdvrUUBFChgwZGzB4aykJi2noJPNcPC9DhozRjNrBrt94wUubnWAtQ4aMmzN+ALIM5PPyye0/AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b9131a5ca31e54205078b286dad06616";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
  (function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'
    } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js'
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s)
  })();
</script>

    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '欢迎再来！';
            clearTimeout(titleTime);
        } else {
            document.title = '悦码小站';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
